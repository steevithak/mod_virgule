2004-08-11  Gary Benson  <gary@inauspicious.org>

	* db.c (db_put_p): Fail gracefully if disk space is exhausted.

2004-02-23  Gary Benson  <gary@inauspicious.org>

	* acct_maint.c (acct_person_serve, acct_certify_serve): Add an
	anchor just above users' certifications lists, and bounce to it
	after certifying the user in question.

	* acct_maint.c (acct_update_serve): Bounce back to your publically
	accessible page after modifying your account.

2004-02-17  Gary Benson  <gary@inauspicious.org>

	* site.c (site_render_recent_changelog): Add permalinks and edit
	buttons to the recentlog.

	* article.c (article_render_reply), proj.c (proj_render_reply):
	Add permalinks to articles and Nick-style projects too.

2004-02-12  Gary Benson  <gary@inauspicious.org>

	* req.h, mod_virgule.c (read_site_config):
	* acct_maint.c (acct_newsub_serve): Allow account creation to be
	blocked with a config.xml parameter.

	* site.c (site_render): Add some new tags to conditionally render
	text depending upon whether account creation is enabled or not.

	* xmlrpc-methods.c (check_cookie): Add a new XML-RPC method to
	check whether a cookie is valid.  Handy for inserting CGIs and
	whatnot into the virgule URL space using VirgulePass.

2003-07-23  James Henstridge  <james@daa.com.au>

	* diary.c (diary_rss_export): fix up the permalinks.

2003-07-21  James Henstridge  <james@daa.com.au>

	* diary.c (diary_rss_export): add title elements to items.  Uses
	the entry date, as that is the closest thing to a date.

2003-07-13  coderman  <coderman@mindspring.com>

	* xmlrpc-methods.c (user_exists, cert_get): Add two new XML-RPC
	methods for remote reading of user cert data.

2003-07-12  Raph Levien  <raph@pixel.artofcode.com>

	* acct_maint.c (acct_person_serve): Add an RSS link on the
	main diary page, complete with orange RSS logo (to be found
	in sample_db/images/rss.png).

2003-07-07  James Henstridge  <james at daa.com.au>

	* diary.c (diary_rss_export): add a <link> element to the items in
	the RSS feed.

2003-04-11  Raph Levien  <raph@pixel.artofcode.com>

	* xmlrpc.c (xmlrpc_response): Add "value" element around array,
	for compliance with the spec.

2003-04-10  Raph Levien  <raph@pixel.artofcode.com>

	* diary.c (diary_rss_export): Adds diary RSS export functionality.

	* rss_export.c (rss_render_from_xml): Use rss_massage_text
	for better quoting and handling of relative URL's.
	(rss_massage_text): New function for massaging text for
	RSS export.

	* util.c (iso_to_time_t): New function to convert ISO times
	into Unix times, for reformatting to RFC 822.

2003-04-05  Raph Levien  <raph@pixel.artofcode.com>

	* proj.c (proj_proj_serve): Fix quoting bug caused by using
	unsafe strings as arg to printf (changed to puts). Thanks
	Jonathan Wakely.

2003-01-20  Gary Benson  <gary@inauspicious.org>

	* mod_virgule.c (read_site_config): Correct bug whereby not
	specifying a <recentlogstyle> would cause an error.

	* diary.h, diary.c (diary_latest_render): Add a parameter to
	select the number of the entry to display.  Also fixes bug whereby
	auth_user() would be called for every entry in the recentlog.

	* site.c (site_render_recent_changelog): Cope with the above.

2003-01-18  Gary Benson  <gary@inauspicious.org>

	* req.h, mod_virgule.c (read_site_config): Read whether or not
	multiple diary entries from the same user will appear in the
	recentlog

	* db_ops.h, db_ops.c (add_recent): Add an extra parameter which
	controls whether the items in the list may be duplicated.

	* diary.c (diary_store_entry):
	* acct_maint.c (acct_newsub_serve):
	* proj.c (proj_newsub_serve, proj_editsub_serve,
	proj_reply_submit_serve): Add extra parameter to calls to
	add_recent().

2002-10-07  Raph Levien  <raph@gimp.org>

	* acct_maint.c (acct_person_serve): Close a cross-site scripting
	hole found by Steve Kemp.

2002-09-29  Raph Levien  <raph@gimp.org>

	* eigen.c (eigen_report): Quote rating keys in the report page.

2002-09-25  Raph Levien  <raph@spectre.artofcode.com>

	* site.c (site_render_recent_changelog): Add threshold
	argument, add coloring by confidence value.

2002-09-25  Raph Levien  <raph@spectre.artofcode.com>

	* acct_maint.c (acct_dbkey): Refactor validity checking into
	separate validate_username() function.

	* acct_maint.h: New validate_username() function for common
	checking of username.

	* rating.c (rating_crank):
	(rating_report): Do validity check on usernames.

	* acct_maint.c (acct_person_serve): Sanitycheck username.

2002-09-24  Raph Levien  <raph@spectre.artofcode.com>

	* acct_maint.c: Patches to avoid segfaults when form arguments
	are missing. Thanks to Jonathan Wakely.

2002-09-24  Raph Levien  <raph@spectre.artofcode.com>
	
	* util.c (render_url): Add general routine to render arbitrary
	URL's.
	(escape_html_attr): Add routine to escape strings used as
	HTML attributes.

	* proj.c: A bunch of new fixes to prevent arbitrary HTML from
	passing through.

	* article.c (article_generic_submit_serve): Better quoting of
	article titles.

	Thanks to Lincoln Yeoh for discovering some problems.

2002-09-21  Raph Levien  <raph@spectre.artofcode.com>

	* acct_maint.c (acct_person_serve, acct_person_index_serve): 
	* tmetric.c (tmetric_index_serve): Run names through nice_text
	to close security hole.

2002-08-11  Gary Benson  <gary@inauspicious.org>

	* site.c (site_render):
	* article.c (article_render_from_xml):
	* proj.c (proj_proj_serve, proj_reply_submit_serve,
	proj_reply_form_serve): Changed wrap=hard to wrap=soft for all
	remaining textareas.

	* diary.c, diary.h: add code to save backup diary entries.

	* diary.c (diary_preview_serve, diary_post_serve): store backups.

	* diary.c (diary_index_serve):
	* site.c (site_render): retrieve backups.

2002-07-11  Gary Benson  <gary@inauspicious.org>

	* site.c (site_render): Add acctname tag that got lost in tree
	merge.

2002-06-30  Gary Benson  <gary@inauspicious.org>

	* req.h, mod_virgule.c (read_site_config): read the project style.

	* acct_maint.c, acct_maint.h: add acct_get_num_old.
	* acct_maint.c (acct_index_serve): conditionally display box for
	number of old messages.

	* site.c (site_render_recent_proj): conditionally render recent
	projects in BBS style.

	* proj.c (proj_proj_serve): conditionally display either staff
	relationships or project replies.

	* proj.c: handle reply posting.

	* proj.c: add next room with new messages stuff.

	* acct_maint.c (acct_index_serve):
	* proj.c: add mark all (project) messages as read stuff.

	* proj.c (proj_url, proj_index_serve, proj_proj_serve,
	proj_new_serve, proj_edit_serve, proj_editsub_serve): cope with
	schema changes and display pages differently according to project
	style.

	* proj.c (proj_newsub_serve, proj_editsub_serve): Never delete
	from recently modified projects if running in BBS style.

2002-06-29  Gary Benson  <gary@inauspicious.org>

	* site.c (site_render): add isloggedin, notloggedin, canpost and
	diarybox tags.

	* style.c, style.h, util.c, util.h: moved render_acceptable_html
	to util.c
	* req.h:
	* mod_virgule.c (read_site_config): store allowed tags in the
	VirguleReq, and read them from config.xml.
	* util.c (render_acceptable_html, nice_htext): get allowed tags
	from the list in the VirguleReq.

	* article.c (article_render_from_xml): add a reply box to the
	article page itself.

	* acct_maint.c, acct_maint.h: add message pointers code.

	* article.c (article_render_replies, article_render_from_xml,
	article_generic_submit_serve): use message pointers.

2002-06-27  Gary Benson  <gary@inauspicious.org>

	* db_ops.c (add_recent): make it an error to try and add a NULL or
	empty value.

	* util.c (escape_uri_arg): urlencode apostrophes too.

	* article.c (article_generic_submit_serve):
	* diary.c (diary_post_serve): Bounce back to the article/recentlog
	after posting a reply/diary entry.

	* article.c (article_generic_submit_serve): Bounce to newly
	created articles too.

2002-06-29  R. Steven Rainwater <steve@ncc.com>

	* mod_virgule.c (read_site_config): Status of the DiaryRating 
	setting is read and used to set the render_diaryratings variable.

	* mod_virgule.c (test_page): Status of render_diaryratings is shown.

	* mod_virgule.c (virgule_handler): Rating handler not used if 
	render_diaryratings is FALSE. Fixed a segfault on the /foo.html 
	diagnostics page caused by the new locking code.

	* site.c (site_render_recent_changelog): Rendering of rating now
	depends on render_diaryratings.

	* acct_maint.c (acct_person_serve): Rendering of the diary rating
	form now depends on render_diaryratings.
	
2002-06-27  Raph Levien  <raph@spectre.artofcode.com>

	* site.c (site_render_recent_changelog): Add rendering of
	rating. It needs to be configurable, but at least there's
	a single variable to switch it on or off.

2002-06-27  Raph Levien  <raph@spectre.artofcode.com>

	* mod_virgule.c (test_page): Add pool argument to db_mk_filename()
	call.

	* rating.c (rating_crank_all): Allocate temporary subpools
	for eigen_crank() computations.

	* eigen.c: Add explicit pool argument to most functions, for
	finer-grained memory allocation.

	* db_xml.c (db_xml_get): Change it to use db_get_p variant
	for finer-grained memory allocation.

	* db.h: db.c: Add db_get_p and db_put_p variants with explicit
	pool specification.

	* eigen.c (eigen_vec_store): Improve precision of stored
	ratings; I underestimated the need for it.
	(eigen_report): Hack to avoid NaN's in variance report.

	* rating.c (rating_rate_diary): Fixed typo in range check,
	thanks to Chia Tee Kiah for spotting it.

2002-06-26  Raph Levien  <raph@spectre.artofcode.com>

	* eigen.c: eigen.h: An implementation of the eigenvector
	based generic metadata ideas.

	* rating.c: rating.h: A simple interface to use the eigenvector
	engine to rate diary entries.

	* hashtable.c: hashtable.h: A reasonably efficient generic
	hashtable, used by the eigenvector trust stuff.
	
	* Makefile: Add hashtable, eigen, rating files. Also change the
	default path for APXS to /usr/bin/apxs, which is convenient for
	Debian users.

	* mod_virgule.c: Added rating_serve() to list of serve handlers.
	Also added simple unit test for hashtable.

	* acct_maint.c (acct_person_serve): Added call to
	rating_diary_form(), so that rating interface is on Web interface.

2002-06-21  Raph Levien  <raph@gimp.org>

	* acct_maint.c: article.c: diary.c: post.c: schema.c:
	Changed wrap=hard to wrap=soft for all textareas.

	* acct_maint.c: Changed graph.dot threshold from 2 to 0,
	so it now reports all edges in the graph.

2002-06-14  Raph Levien  <raph@spectre.artofcode.com>

	* mod_virgule.c (test_serve): Moved lock upgrade so it
	wouldn't trigger on 404's.

	* db.c (db_lock_upgrade): Make locks read-only by default,
	and provide explicit method to upgrade to read/write. This
	should improve lock contention delays significantly.

	* db.h: Add public prototype for db_lock_upgrade().

	* acct_maint.c: article.c: diary.c: mod_virgule.c: post.c:
	proj.c: tmetric.c: add db_lock_upgrade() calls as needed when
	writing into the database.

2002-04-24  Gary Benson  <gary@inauspicious.org>

	* acct_maint.c (acct_index_serve):
	* article.c (article_render_reply, article_render,
	article_form_serve, article_generic_submit_serve,
	article_submit_serve, article_reply_form_serve,
	article_reply_submit_serve, article_recent_render,
	article_index_serve, article_older_serve, article_num_serve):
	* post.c (post_form_serve, post_submit_serve):
	* rss_export.c (rss_index_serve):
	* style.c (render_sitemap): Mark up "article", "articles",
	"Article" and "Articles" for translation.

	* acct_maint.c (acct_index_serve, acct_person_index_serve):
	* article.c (article_form_serve, article_generic_submit_serve,
	article_submit_serve, article_reply_submit_serve):
	* post.c (post_form_serve, post_submit_serve):
	* proj.c (proj_newsub_serve): Suck indefinite articles into
	translation blocks, so we now have translations for "a person", "a
	project" and "an article" as well as the rest.

	* proj.c (proj_new_serve, proj_newsub_serve, proj_index_serve,
	proj_edit_serve, proj_editsub_serve, proj_relsub_serve): Change
	"project page" to "project".

2002-04-15  Gary Benson  <gary@inauspicious.org>

	* req.h:
	* mod_virgule.c (virgule_handler, test_page): Add configuration
	fields for the site's name and base uri.

	* rss_export.c (rss_render_from_xml, rss_render, rss_index_serve):
	Use configured site name and uri instead of hardwired one.

	* mod_virgule.c (read_site_config, virgule_handler): Load
	configuration from file.

	* sample_db/config.xml: Imported configuration file.

2002-04-14  Gary Benson  <gary@inauspicious.org>

	* buffer.h:
	* buffer.c: Add translation functionality to buffers.

	* mod_virgule.c: Set no translations (which is different to "don't
	translate anything").

	* acct_maint.c (acct_index_serve, acct_person_index_serve,
	acct_person_serve, act_certify_serve):
	* proj.c (proj_relsub_serve):
	* style.c (render_sitemap): Mark up "person", "people", "Person"
	and "People" for translation.

	* acct_maint.c (acct_person_serve):
	* proj.c (proj_new_serve, proj_newsub_serve, proj_index_serve,
	proj_proj_serve, proj_edit_serve, proj_editsub_serve,
	proj_relsub_serve):
	* style.c (render_sitemap): Mark up "project", "projects",
	"Project" and "Projects" for translation.

	* mod_virgule.c (test_page): Add the various configuration items
	to the test page.

2002-04-13  Gary Benson  <gary@inauspicious.org>

	* req.h:
	* certs.c (render_cert_level_begin): Move the names of special
	users into the VirguleReq.

	* mod_virgule.c (virgule_handler): Set the special users when
	initialising the VirguleReq.

2002-04-12  Gary Benson  <gary@inauspicious.org>

	* certs.h:
	* certs.c (cert_num_levels):
	* tmetric.h:
	* tmetric.c (tmetric_serve, tmetric_run): 
	* acct_maint.c (acct_person_serve): Remove the global variable
	cert_level_n. Note that tmetric_run is now a static function,
	although this could be worked around if necessary.

	* req.h:
	* certs.h:
	* certs.c (cert_num_levels, cert_level_from_name,
	cert_level_to_name):  Move the level names into the VirguleReq.

	* mod_virgule.c (virgule_handler): Set the level names when
	initialising the VirguleReq.

	* acct_maint.c (acct_person_serve): Remove the final couple of
	hardwired cert names.

	* req.h:
	* tmetric.c (tmetric_index_serve): Move the seeds and capacities
	into the VirguleReq.

	* mod_virgule.c (virgule_handler): Set the seeds and capacities
	when initialising the VirguleReq.

2002-04-10  Gary Benson  <gary@inauspicious.org>

	* certs.h
	* certs.c (cert_level_from_name, cert_level_to_name, cert_get,
	cert_set): Pass the VirguleReq to cert_* functions.

	* acct_maint.c (acct_index_serve, acct_person_graph_serve,
	acct_person_serve, acct_certify_serve):
	* certs.c (render_cert_level_begin):
	* proj.c (proj_ok_to_edit, proj_edit_serve, proj_editsub_serve,
	proj_relsub_serve):
	* req.c (req_get_tmetric_level, req_ok_to_post):
	* tmetric.c (tmetric_run, tmetric_index_serve): Respect new
	semantics of cert_* functions.

2002-04-22  R. Steven Rainwater  <steve@ncc.com>

	* mod_virgule.c (virgule_handler): Fixed a prefix but that
	prevented the foo.html diagnostics page from being displayed if
	the configured Location was different than the DocumentRoot.

	* site.c (site_serve): Fixed a prefix bug that caused a root URI
	with no trailing slash to redirect to the DocumentRoot rather than
	to the Location. Thanks to Jeff Macdonald for noticing the
	problem.

2002-04-22  Gary Benson  <gary@inauspicious.org>

	* auth.c (auth_user_with_cookie): Filter names less harshly.
	Thanks to R. Steven Rainwater for the patch.

2002-04-13  Raph Levien  <raph@pixel.artofcode.com>

	* xmlrpc.c (xmlrpc_value_datetime): Increase correctness
	for older dates in database lacing hh:mm:ss.

	* diary.c (diary_serve): Add "/diary" -> "/diary/" redirect.

2002-04-13  Gary Benson  <gary@inauspicious.org>

	* Makefile: Add make dep rule (which runs makedepend) from Neale.

2002-04-11  R. Steven Rainwater  <steve@ncc.com>

	* xml_util.h:
	* xml_util.c (xml_put_prop): removed this function which provided
	backward compatibilty with a very old version of libxml1.

	* acct_maint.c (acct_newsub_serve, acct_update_serve): 
	* db_ops.c (add_recent, db_relation_put_field):
	* proj.c (proj_newsub_serve, proj_editsub_serve):
	* schema.c (schema_put_field):
	Replaced xml_put_prop with direct call to xmlSetProp.

2002-04-12  Gary Benson  <gary@inauspicious.org>

	* xmlrpc.c:
	* xmlrpc-methods.c: Remove header included for debugging.

2002-04-09  R. Steven Rainwater  <steve@ncc.com>

	* acct_maint.c (acct_loginsub_serve):
	* mod_virgule.c (test_page):
	* site.c (site_serve, site_render): 
	* style.c (render_header_raw):

	* tmetric.c (tmetric_test_serve): Add HTML 4.01 Transitional
	DOCTYPE and specify ISO-8859-1 encoding.

	* site.c (site_serve, site_render): Fix rendering of <img> tags
	and removed spurious linefeeds in HTML output.

2002-04-09  Gary Benson  <gary@inauspicious.org>

	* acct_maint.c (acct_index_serve):
	* proj.c (proj_edit_serve, proj_editsub_serve, proj_relsub_serve):
	Remove some hardwired cert names.

	* acct_maint.c (acct_person_graph_serve): Quote usernames to stop
	graphviz choking on usernames that don't begin with letters.
	Thanks to Chad Miller for the patch.

2002-04-09  R. Steven Rainwater  <steve@ncc.com>

	* auth.c (auth_user_with_cookie): Added code to add the name of
	authorized users to the Apache request record. This will allow
	Apache to log user authorization normally and make user login info
	available through log statistics programs such as Webalizer.
	Modified by Gary Benson so it a) does not trample on usernames put
	there by Apache, and b) filters names more harshly.

2002-04-08  Gary Benson  <gary@inauspicious.org>

	* db_ops.c:
	* proj.c (proj_relsub_serve): Bye bye compiler warnings.

2002-04-06  R. Steven Rainwater  <steve@ncc.com>

	* mod_virgule.c (virgule_handler): Removed reference to main_page().

	* Makefile: Removed reference to main_page.c.

	* main_page.c:
	* main_page.h: Removed these unused files.

2002-04-06  Gary Benson  <gary@inauspicious.org>

	* buffer.h:
	* buffer.c (buffer_new, buffer_write, buffer_send_response):
	Generate and handle ETags.  Note that the calling semantics of
	buffer_send_response have been changed. Also generates a
	Content-MD5 tag, since it costs nothing.

	* req.c (send_response):
	* acct_maint.c (acct_login): respect new semantics of
	buffer_send_response.

2002-04-05  Gary Benson  <gary@inauspicious.org>

	* mod_virgule.c (set_virgule_pass, xlat_handler): Add VirgulePass
	directive in place of hardwired list of URL exceptions. Thanks to
	R. Steven Rainwater for the patch.

2002-04-04  Gary Benson  <gary@inauspicious.org>

	* xmlrpc.c (xmlrpc_value_string): Use xmlNewTextChild rather than
	xmlNewChild, so escaping is now correct (Spotted by Chad Miller
	and Chris Vaughan).

	* article.c (article_submit_serve): Detect and reject duplicate
	article postings. Thanks to R. Steven Rainwater for the patch.

	* mod_virgule.c: Add a version number. Thanks to R. Steven
	Rainwater for the patch.
	
	* xmlrpc.c (xmlrpc_value_datetime, xmlrpc_response):
	* xmlrpc-methods.c (diary_get_dates): Add a marshaller for the
	dateTime.iso8601 datatype, and a new XML-RPC method to get the
	creation and modification dates of a diary entry. Thanks to Sam
	Phillips for the Patch.

	* sample_db/site/xmlrpc.xml: Document the above.

2002-04-03  Gary Benson  <gary@inauspicious.org>

	* mod_virgule.c (xlat_handler): Add url exception for robots.txt.

2002-03-31  Gary Benson  <gary@inauspicious.org>

	* acct_maint.c (acct_index_serve): Remove a couple of superfluous
	hardwired references to Advogato.

	* certs.h:
	* certs.c: Add new function render_cert_level_text, which renders
	a textual representation of the cert level that will be hidden in
	graphical browsers.

	* article.c (article_render_reply, article_render_from_xml):
	* site.c (site_render_recent_acct, site_render_recent_changelog):
	Use the above.

2002-03-30  Gary Benson  <gary@inauspicious.org>

	* sample_db/site/certs.xml:
	* sample_db/site/code.xml:
	* sample_db/site/index.xml:
	* sample_db/site/mission.xml:
	* sample_db/site/recentlog.xml:
	* sample_db/site/syndicate.xml:
	* sample_db/site/trust-metric.html: Synchronize sample_db with
	live site's database.

	* mod_virgule.c: add url prefix exception for stylesheet dir.

	* sample_db/css/global.css:
	* sample_db/css/notns4.css: Imported stylesheets.
	
	* style.c (render_header_raw): reference external stylesheets
	rather than embedding one.

	* style.c: #define STYLE turned on.

	* certs.h:
	* certs.c (render_cert_level_begin, render_cert_level_end): Remove
	nested tables and replace with CSS magic. Note that the calling
	semantics of the functions have been transparently changed.

	* tmetric.c (tmetric_index_serve): Replaced hardwired colours with
	equally hardwired references to CSS classes.

	* acct_maint.c (acct_person_index_serve):
	* article.c (article_render_from_xml, article_generic_submit_serve):
	* site.c (site_render_recent_acct, site_render_recent_changelog,
	site_render_recent_proj, site_render):
	* sample_db/site/index.xml:
	* sample_db/site/proj.xml:
	* sample_db/site/recentlog.xml: Remove all spacers and font tags
	since they are now unneeded.

	* certs.h: add another cert style: CERT_STYLE_MEDIUM.

	* article.c (article_render_reply, article_generic_submit_serve):
	* site.c: (site_render_recent_changelog): Use CERT_STYLE_MEDIUM
	for replies to articles and recentlog entries.

2002-03-27  Gary Benson  <gary@inauspicious.org>

	* sample_db/site/index.xml: Add a link to the XML-RPC page from
	the front page, as requested by Barry Pederson and Paulo Andre
	amongst others.

2002-03-23  Gary Benson  <gary@inauspicious.org>

	* xmlrpc.c (xmlrpc_response): Fix bug that causes functions that
	return multiple values to have a mangled response (fix courtesy of
	Raph Levien).

	* xmlrpc.c (xmlrpc_response): Fix a memory leak (admittedly one
	that wouldn't happen unless there was a programmer error in the
	method being served).

	* xmlrpc.c (xmlrpc_fault, xmlrpc_serve): Fix bug that causes
	multiple responses under fault conditions (spotted by Mark
	Hershberger and Dave Winer).

	* xmlrpc.c (xmlrpc_unmarshal_params): Fix bug whereby parameters
	of unspecified type were reported as errors (spotted by Dave
	Winer).

	* xmlrpc.c (xmlrpc_unmarshal_params): When reporting parameter
	type errors, index the parameters as base-1 rather than base-0.

2002-02-16  Gary Benson  <gary@inauspicious.org>

	* diary.h:
	* diary.c (diary_post_serve): Move entry storage code into new
	function, diary_store_entry().

	* xmlrpc-methods.c:
	* sample_db/site/xmlrpc.xml: Add new XML-RPC methods diary.len(),
	diary.get() and diary.set().

2002-02-16  Gary Benson  <gary@inauspicious.org>

	* acct_maint.h:
	* acct_maint.c (acct_loginsub_serve): Move bulk of
	acct_loginsub_serve() into new function acct_login().

	* xmlrpc-methods.c:
	* sample_db/site/xmlrpc.xml: Add new XML-RPC method authenticate()
	which wraps acct_login().
	
2002-02-16  Gary Benson  <gary@inauspicious.org>

	* auth.h:	
	* auth.c (auth_user): Move bulk of auth_user() into new function
	auth_user_with_cookie().

	* xmlrpc-methods.h:
	* xmlrpc.h:
	* xmlrpc.c: created new function xmlrpc_auth_user() which wraps
	auth_user_with_cookie().

2002-02-15  Gary Benson  <gary@inauspicious.org>

	* Makefile:
	* mod_virgule.c (virgule_handler):
	* xmlrpc.c, xmlrpc.h:
	* xmlrpc-methods.c, xmlrpc-methods.h:
	* sample_db/site/xmlrpc.xml: Add XML-RPC API.

2002-03-20  Raph Levien  <raph@pixel.artofcode.com>

	* mod_virgule.c (xlat_handler): Adds list of "exceptions" url
	prefixes, good for serving images and other static files.

2002-03-19  Raph Levien  <raph@pixel.artofcode.com>

	* acct_maint.c (acct_person_diary_xml_serve):
	* rss_export.c (rss_index_serve): Fix memory leak. Thanks to
	Gary Benson for the patch.

	* tmetric.c (tmetric_index_serve): Reduces time spent holding
	global db lock when writing tmetric cache.

2002-03-18  Raph Levien  <raph@pixel.artofcode.com>

	* db.c (db_dir_max_in_level): Fixes embarrassing bug that
	miscounts numeric directories when the _00.._99 entries follow
	_a.._d in the readdir() order.

2001-05-13  Raph Levien  <raph@acm.org>

	* tmetric.c (tmetric_index_serve): Fixes tmetric cache so that
	the existence of a name preceding "-" won't break things. Thanks
	to Neale Pickett for the patch.

2001-02-22  Raph Levien  <raph@acm.org>

	* db_ops.c (add_recent): Uses xmlNewTextChild rather than
	xmlNewChild, so escaping is now correct.

	* util.c: Added <proj> tag and renderer.

	* style.c (render_acceptable_html): Added <proj> to list.

	* site.c (site_render_recent_proj): Changed to use
	render_proj_name (which escapes the URL correctly) rather than
	hand-rolled HTML.

	Thanks to R. Steven Rainwater and Matt McClanahan for patches.

2001-01-24  Raph Levien  <raph@acm.org>

	* auth.c (auth_user): Fixes denial of service attack. Thanks
	to R. Steven Rainwater for the patch.

2000-11-07  Raph Levien  <raph@acm.org>

	* req.h:
	* req.c:
	* tmetric.h:
	* tmetric.c: Replaced tmetric.xml with plain-text file, which
	removed a major performance bottleneck.

2000-09-02  Raph Levien  <raph@acm.org>

	* diary.c: Provide separate creation and last update dates.

	* wiki.c: Liberalize InterWiki lexing.

2000-08-24  Raph Levien  <raph@acm.org>

	* wiki.c (wiki_link): Fix embarassing bugs.

	* style.c (render_acceptable_html): Add wiki and person tags.

2000-08-24  Raph Levien  <raph@acm.org>

	* util.h:
	* util.c (nice_htext): Added handlers for special tags (wiki
	and person). First arg is now a VirguleReq rather than a pool.

	* acct_maint.c (acct_person_serve):
	* article.c (article_generic_submit_serve):
	* diary.c (diary_preview_serve, diary_post_serve):
	* proj.c (proj_relsub_serve): Changed first arg of nice_htext
	to vr.

	* req.h: Added render_data table, used by wiki to store
	intermap.

	* wiki.h:
	* wiki.c: Renders InterWiki links.

	* Makefile: Added wiki.o.

Tue Jun  6 22:47:04 2000  Raph Levien  <raph@acm.org>

	* acct_maint.c: Fixed problem of logging into an account
	that is an alias. It now follows the alias link.

	* proj.c (proj_proj_serve): Fixed escaping of project name in
	cases where it includes "+".

	* util.c: Added escape_uri_arg() function that escapes query
	arguments correctly.

2000-04-13  Raph Levien  <raph@gimp.org>

	* util.c (nice_htext): Fixed a brown paper bag bug in which
	nice_htext would run off the end of the buffer.

	* article.c (article_generic_submit_serve): Fixed a bug in which
	the nice_text version of the title was ignored.

	* util.c: Added escape_noniso_char, which translates non-iso
	characters to reasonable replacements. Both nice_text and
	nice_htext use this now. This fixes a vulnerability where some
	browsers (notably Netscape) interpret a tag between 0x8B and 0x9B
	characters as an HTML tag, and at the same time takes care of the
	"dreaded question mark" problem when people post from Windows
	browsers.

Sat Apr  8 13:05:38 2000  Raph Levien  <raph@acm.org>

	* proj.c (proj_proj_serve): Properly escape project name in URI.

	* article.c (article_reply_submit_serve): lead and body are now
	passed to this routine raw so that they don't accumulate <p> tags.

	* util.c: Added "pre" tag to acceptable html.

	* rss_export.c (rss_index_serve): Changed root element to
	lowercase "rss".

	* article.c (article_generic_submit_serve): Check for empty body
	when submitting a reply.

	* article.c (article_render_reply):
	* diary.c (diary_render): Added <a name=""> tags to individual
	replies and diary entries. Thanks to Kelly for the patch.
	
	* diary.c: Fixed segfaulting when diary is empty.

Sat Mar  4 16:14:23 2000  Raph Levien  <raph@acm.org>

	* proj.c:
	* diary.c (diary_post_serve): 
	* acct_maint.c (acct_newsub_serve): Increased add_recent to 50.
	This makes sense now that the xml tags in site.c actually pay
	attention to their arguments.

	* diary.c (validate_key): Patch by R. Steven Rainwater to allow
	key of -1, which autoassigns a new post number. This makes it
	easier to use a client for posting diary entries.

2000-03-04  Laurent Gauthier  <lolo@seul.org>

	* site.c (site_render_recent_changelog): Implemented this function
	to render the <recentlog> tag.

	* site.c (site_render): Added a new tag <recentlog>, that will
	display the most recent diary entries.

	* diary.c (diary_latest_render): New function used to render the
	latest diary update for a given user.

	* diary.h: Added prototype for diary_latest_render().

Thu Mar  2 17:18:30 2000  Raph Levien  <raph@acm.org>

	* diary.c (diary_serve): Fixed prefix bug.

	* acct_maint.c (acct_person_serve): Fixed prefix bug.

	* site.c: Made "recent" tags actually limit the number displayed.

Fri Feb 25 13:41:21 2000  Raph Levien  <raph@acm.org>

	* diary.c (diary_render): Fixed a little bug that got introduced
	with the diary editing code.

Fri Feb 25 12:56:14 2000  Raph Levien  <raph@acm.org>

	* acct_maint.c (acct_person_serve): Made an explicit "[Edit]" link
	for diary editing, rather than just making the date clickable.
	Made the personal information page automatically redirect through
	symlinks. Thus, if the account Foo exists and /person/foo/ is
	requested, it will redirect to /person/Foo/.

Wed Feb 23 23:28:12 2000  Phil Schwan  <pschwan@linuxcare.com>

	* diary.c: Added diary editing.  In order to re-use code already
	present in diary_post_serve and diary_preview_serve, I made them
	get the diary's index from the form field "key".  This key is run
	through validate_key() which does simple bounds checking and returns
	a key suitable for passing to db_xml_put.  Keys are originally set
	in diary_index_serve (adding a new diary entry) and diary_edit_serve.

Wed Feb 23 15:52:20 2000  Raph Levien  <raph@acm.org>

	* acct_maint.c: When you create an account with uppercase
	characters, it now creates an "alias" account with the
	all-lowercase version of the name, pointing to the real account.
	Conversely, it checks the all-lc name on account creation. This
	blocks people from creating accounts colliding in name (all except
	for case) with existing accounts. This was a serious problem
	because ap_table_* is not case sensitive.
	
	* tmetric.c: Changes to work with "alias" profiles.

Thu Feb 17 11:46:34 PST 2000  Manish Singh  <yosh@gimp.org>

	* Makefile: use glib-config and xml-config directly, to avoid
	gnome build time dependancy

	* mod_virgule.c: moved gnome-xml #includes to the beginning, so we
	get xmlNode declared for diary.h

2000-01-17  Raph Levien  <raph@gimp.org>

	* diary.c (diary_export): Initial support for exporting diaries
	as XML files.

	* diary.h: diary_export declaration.

	* acct_maint.c (acct_person_diary_xml_serve): Added
	/person/<username>/diary.xml into namespace served.

Mon Jan 10 11:11:49 2000  Raph Levien  <raph@acm.org>

	* acct_maint.c: Support for "older entries" for diary.

	* diary.h, diary.c: Implemented "older entries" link. Implemented a
	"Preview" button for diary posting.

	* article.h, article.c: Implemented "older articles" link.
	Implemented a "Preview" button for article and reply posting.

	* util.c: Added str_subst utility function, used for previews.

Wed Dec 15 14:51:51 1999  Raph Levien  <raph@acm.org>

	* apache_util.c (read_post_data): bytes_read == 0 is an error
	condition. It was looping infinitely on this.

Wed Dec  8 12:24:49 1999  Raph Levien  <raph@acm.org>

	* db_xml.c (db_xml_free): Fixed a really _dumb_ memory leak.

Fri Nov 26 16:02:35 1999  Raph Levien  <raph@acm.org>

	* acct_maint.c: Shows project relationships, also have graph
	display for playing with dot.

	* article.c: Only display "Reply..." link twice if number of
	replies != 0.

	* db_ops.c: Enforce uniqueness when putting new relations in the
	db.

	* proj.c: Correct url escaping for project names. Also
	sanitychecking of new project names.

	* tmetric.c: Added alan :)

1999-11-15  Raph Levien  <raph@gimp.org>

	* db_ops.c (db_relation_put_field): Naming changes.

	* proj.c: Actually stores the "staff" relationship between project
	and person now.

Mon Nov 15 15:43:47 1999  Raph Levien  <raph@acm.org>

	* proj.c: Project page now works pretty well.

	* schema.c: Another new thing is a schema system for automating
	some of the drudge work in having forms with lots of fields. This
	is used throughout proj.c, and should probably be retrofitted to a
	few other things.

	* db_ops.c: I'm starting on support for relations in the database
	abstraction, which will be useful for multiway relations. For
	example, if person X works on project Y, it will (with one
	operation) store information in both /acct/X and /proj/Y.

	* some other minor fixes too, like alphabetizing the /person/ list
	and so on.

